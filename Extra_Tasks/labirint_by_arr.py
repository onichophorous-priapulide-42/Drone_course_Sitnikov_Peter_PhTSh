import numpy as np
import cv2
import random

prison = cv2.VideoCapture(0)
aruco_dict = cv2.aruco.getPredefinedDictionary(cv2.aruco.DICT_6X6_1000)
parameters = cv2.aruco.DetectorParameters()
detector = cv2.aruco.ArucoDetector(aruco_dict, parameters)
try:
    while True:
        t, frame = prison.read()
        if frame is None:
            continue
        gray = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)
        corners, ids, rejected = detector.detectMarkers(gray)
        # ids = [[0], [6], [4]]
        # corners = [[[x, y], [x, y], [x, y], [x, y]], [...], [...]]
        if ids is not None:
            print("Detected markers:", ids, corners)
            cv2.aruco.drawDetectedMarkers(frame, corners, ids)
            mean = 
            t = '''
            for i in range(0, len(ids)):
                cv2.circle(frame, (np.mean(corners[i], axis=1), np.mean(corners[i], axis=0)), 10, "blue")
            '''
        #cv2.imshow('window', frame)
        cv2.waitKey(1)
except KeyboardInterrupt:
    prison.release()
def line(img, arr, x, y, m):
    if m == 1:
        img[x*20, y*20:(y+1)*20,:] = 255
        y += 1
    elif m == 2:
        img[x*20:(x+1)*20, y*20,:] = 255
        x += 1
    elif m == 3:
        img[x*20, (y-1)*20:y*20:,:] = 255
        y -= 1
    elif m == 4:
        img[(x-1)*20:x*20, y*20,:] = 255
        x -= 1
    elif m == 5:
        for i in range(0, 20):
            img[x*20+i, y*20+i,:] = 255
        x += 1
        y += 1
    elif m == 6:
        for i in range(0, 20):
            img[x*20+i, y*20-i,:] = 255
        x += 1
        y -= 1
    elif m == 7:
        for i in range(0, 20):
            img[x*20-i, y*20-i,:] = 255
        x -= 1
        y -= 1
    elif m == 8:
        for i in range(0, 20):
            img[x*20-i, y*20+i,:] = 255
        x -= 1
        y += 1
    return [img, x, y]


def labir(base):
    arr = np.zeros((200, 200, 3))
    '''
    base2 = [743, 392, 724, 524, 231, 421, 183, 384, 861, 572, 304, 103, 11, 292, 564, 41, 472, 933, 684, 631, 884, 624, 71, 173, 412, 904, 804, 692, 953, 792, 1, 363, 353, 973, 153, 993, 372, 404, 672, 312, 163, 484, 612, 641, 943, 831, 592, 733, 113, 584, 704, 21, 464, 651, 512, 123, 753, 133, 192, 983, 143, 251, 712, 431, 284, 272, 261, 333, 532, 892, 851, 784, 201, 871, 773, 841, 963, 923, 492, 821, 92, 343, 763, 211, 441, 221, 504, 31, 452, 664, 543, 241, 604, 51, 811, 81, 61, 553, 323, 913]
    base3 = [122, 542, 183, 974, 963, 573, 983, 502, 874, 302, 734, 513, 81, 401, 62, 274, 662, 461, 421, 314, 71, 492, 383, 2, 292, 222, 454, 334, 683, 943, 642, 762, 654, 322, 583, 892, 114, 154, 822, 374, 702, 742, 902, 434, 283, 162, 792, 754, 11, 914, 522, 883, 622, 483, 533, 354, 142, 254, 174, 214, 692, 634, 474, 134, 31, 993, 562, 774, 674, 414, 92, 234, 262, 242, 202, 602, 553, 342, 814, 362, 923, 954, 51, 934, 592, 714, 834, 42, 102, 22, 862, 802, 441, 854, 614, 392, 842, 192, 722, 783]
    based4 = [880, 170, 430, 890, 614, 814, 180, 940, 290, 344, 150, 450, 650, 350, 50, 20, 530, 414, 902, 930, 365, 550, 702, 385, 420, 260, 744, 560, 844, 513, 80, 220, 990, 160, 690, 920, 255, 60, 736, 774, 235, 520, 145, 214, 15, 596, 492, 374, 202, 802, 830, 280, 502, 40, 90, 980, 314, 102, 602, 576, 630, 674, 30, 440, 666, 70, 970, 686, 826, 390, 620, 460, 790, 870, 330, 125, 302, 756, 114, 130, 474, 914, 714, 720, 850, 190, 860, 960, 540, 275, 401, 580, 760, 780, 2, 320, 244, 646, 950, 480]
    based5 = [753, 963, 983, 412, 943, 261, 183, 631, 41, 1, 651, 133, 512, 684, 221, 831, 404, 11, 201, 92, 71, 312, 763, 241, 123, 572, 173, 923, 553, 484, 564, 851, 624, 804, 592, 892, 733, 641, 792, 464, 841, 363, 392, 612, 904, 421, 664, 692, 953, 103, 492, 672, 532, 871, 51, 604, 704, 913, 272, 353, 292, 784, 21, 884, 163, 153, 584, 333, 993, 323, 81, 284, 113, 211, 724, 452, 372, 821, 524, 933, 384, 431, 343, 441, 251, 31, 231, 743, 143, 811, 712, 861, 543, 472, 773, 304, 504, 192, 61, 973]
    based6 = [364, 72, 1, 323, 32, 773, 61, 41, 993, 983, 144, 933, 664, 444, 452, 431, 21, 733, 702, 963, 492, 821, 344, 841, 464, 523, 352, 672, 621, 923, 224, 903, 943, 411, 611, 533, 232, 753, 651, 12, 763, 113, 284, 831, 861, 302, 572, 713, 553, 811, 784, 502, 211, 953, 641, 564, 244, 631, 851, 743, 472, 164, 584, 152, 392, 723, 124, 884, 102, 184, 601, 333, 692, 543, 172, 871, 513, 252, 421, 801, 264, 92, 484, 81, 272, 201, 792, 684, 913, 592, 401, 384, 973, 132, 372, 292, 313, 192, 52, 892]
    based7 = [502, 281, 671, 471, 881, 393, 754, 414, 261, 302, 773, 921, 822, 714, 343, 51, 961, 383, 651, 1, 974, 251, 11, 92, 373, 692, 661, 292, 934, 322, 783, 461, 231, 553, 102, 573, 854, 333, 642, 722, 183, 451, 941, 363, 634, 563, 993, 431, 143, 422, 681, 202, 353, 163, 742, 402, 492, 211, 441, 914, 61, 153, 793, 173, 123, 734, 982, 762, 31, 221, 241, 834, 892, 593, 522, 702, 862, 954, 614, 41, 81, 583, 842, 534, 602, 901, 481, 514, 133, 314, 271, 814, 802, 21, 542, 113, 71, 871, 193, 622]
    based8 = [933, 744, 523, 163, 733, 133, 371, 884, 444, 232, 902, 2, 11, 821, 652, 173, 581, 114, 861, 411, 552, 51, 344, 41, 831, 364, 314, 914, 272, 923, 384, 143, 61, 21, 152, 571, 953, 261, 431, 702, 392, 352, 323, 81, 543, 102, 502, 183, 611, 683, 221, 252, 513, 302, 692, 814, 192, 483, 284, 784, 92, 844, 473, 464, 792, 993, 644, 871, 773, 722, 71, 851, 292, 493, 602, 621, 632, 214, 401, 892, 122, 943, 802, 664, 31, 973, 592, 561, 452, 533, 333, 714, 672, 752, 963, 764, 983, 202, 244, 421]
    based9 = [662, 211, 613, 313, 623, 431, 603, 833, 881, 31, 573, 763, 991, 481, 791, 261, 143, 193, 241, 733, 913, 221, 291, 41, 943, 103, 112, 353, 1, 742, 513, 81, 543, 183, 343, 282, 553, 173, 852, 451, 703, 723, 671, 841, 461, 823, 581, 952, 681, 21, 383, 532, 891, 781, 441, 961, 503, 133, 523, 123, 271, 871, 563, 651, 631, 813, 203, 163, 421, 71, 61, 322, 641, 51, 753, 333, 861, 981, 591, 11, 391, 713, 303, 153, 903, 413, 363, 231, 803, 971, 933, 691, 373, 771, 403, 923, 472, 92, 251, 491]
    based10 = [633, 733, 102, 33, 83, 263, 281, 302, 582, 753, 453, 763, 292, 653, 382, 423, 333, 823, 171, 853, 863, 953, 23, 353, 724, 963, 213, 643, 663, 923, 782, 51, 913, 113, 343, 72, 414, 834, 234, 253, 793, 153, 973, 533, 502, 944, 692, 902, 513, 93, 401, 673, 872, 743, 373, 393, 602, 363, 813, 2, 131, 472, 843, 41, 443, 483, 983, 123, 523, 681, 311, 163, 243, 893, 993, 182, 324, 702, 13, 144, 493, 463, 61, 773, 221, 193, 614, 202, 802, 273, 593, 433, 553, 883, 543, 563, 571, 713, 933, 623]
    '''
    for i in base:
        x = i//100
        y = (i%100)//10
        m = i%10
        arr[x*20, y*20,:] = m
    x = 0
    y = 0
    img = arr.copy()
    old_mark = 0
    try:
        while arr[x*20,y*20,1] != 0:
            mark = arr[x*20,y*20,1]
            tmp = line(img, arr, x, y, mark)
            img = tmp[0]
            old_xy = (x, y)
            x = tmp[1]
            y = tmp[2]            
    except:
        pass

    img[::20, ::20] = (255, 0, 0)
    img[old_xy[0]*20, old_xy[1]*20] = (0, 255, 0)
    img = np.vstack((np.swapaxes(img, 1, 0)[::-1,:,:]*(int(255/4)), np.zeros((20,200,3))))
    img = np.hstack((np.zeros((220,20,3)), img))
    cv2.imshow("a", img)


